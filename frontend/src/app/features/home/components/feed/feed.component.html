<!-- Instagram-style Feed -->
<div class="instagram-feed">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div *ngFor="let item of [1,2,3]" class="post-skeleton">
      <div class="skeleton-header">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-user-info">
          <div class="skeleton-username"></div>
          <div class="skeleton-time"></div>
        </div>
      </div>
      <div class="skeleton-image"></div>
      <div class="skeleton-actions"></div>
    </div>
  </div>

  <!-- Posts and Reels -->
  <div *ngIf="!loading" class="feed-posts">
    <!-- Debug info -->
    <div *ngIf="posts.length === 0" class="no-posts-message">
      <p>No posts available. Loading posts...</p>
    </div>
<section *ngIf="!loading; else loadingTpl" class="posts-feed">

  <!-- Loop over posts -->
  <article *ngFor="let post of posts; trackBy: trackByPostId" class="instagram-post">

    <!-- Header -->
    <header class="post-header">
      <div class="user-info">
        <img [src]="post.user?.avatar"
             [alt]="post.user?.username || 'User'"
             class="user-avatar">
        <div class="user-details">
          <h3 class="username">{{ post.user?.username || 'Unknown User' }}</h3>
          <span class="post-time">{{ getTimeAgo(post.createdAt) }}</span>
        </div>
      </div>
    </header>

    <!-- Media -->
    <div class="post-media">
      <img *ngIf="post.mediaType === 'image'"
           [src]="post.mediaUrl"
           [alt]="post.caption"
           class="post-image">

      <video *ngIf="post.mediaType === 'video'"
             [src]="post.mediaUrl"
             class="post-video"
             controls
             muted
             loop></video>
    </div>

    <!-- Actions -->
    <div class="post-actions">
      <button (click)="toggleLike(post)">
        <i [class]="post.isLiked ? 'fas fa-heart liked' : 'far fa-heart'"></i>
      </button>
      <button (click)="focusCommentInput(post)">
        <i class="far fa-comment"></i>
      </button>
      <button (click)="sharePost(post)">
        <i class="far fa-paper-plane"></i>
      </button>
      <button (click)="toggleSave(post)">
        <i [class]="post.isSaved ? 'fas fa-bookmark saved' : 'far fa-bookmark'"></i>
      </button>
    </div>

    <!-- Likes -->
    <div class="likes" *ngIf="post.likes > 0">
      {{ post.likes }} {{ post.likes === 1 ? 'like' : 'likes' }}
    </div>

    <!-- Caption -->
    <div class="caption">
      <span class="username">{{ post.user?.username || 'Unknown User' }}</span>
      <span class="text">{{ post.caption }}</span>
    </div>

    <!-- Hashtags -->
    <div class="hashtags" *ngIf="post.hashtags?.length > 0">
      <span *ngFor="let tag of post.hashtags" class="hashtag">#{{ tag }}</span>
    </div>

    <!-- Comments preview -->
    <div class="comments" *ngIf="post.commentsCount > 0">
      <button (click)="toggleComments(post)">
        View all {{ post.commentsCount }} comments
      </button>
    </div>

    <!-- Add comment -->
    <div class="add-comment">
      <input type="text"
             placeholder="Add a comment..."
             [(ngModel)]="newComment"
             (keyup.enter)="addComment(post)">
  <button (click)="addComment(post)" [disabled]="!newComment.trim()">Post</button>
    </div>

    <!-- Products -->
    <div class="products" *ngIf="post.products?.length > 0">
      <h4>Tagged Products:</h4>
      <div *ngFor="let product of post.products" class="product-item">
        <img [src]="product.image" alt="{{ product.name }}" class="product-img">
        <div class="details">
          <span>{{ product.name }}</span>
          <span *ngIf="product.price">{{ formatPrice(product.price) }}</span>
        </div>
        <div class="product-actions">
          <button (click)="addToCart(product)">ðŸ›’</button>
          <button (click)="addToWishlist(product)">ðŸ’–</button>
          <button (click)="buyNow(product)">âš¡ Buy</button>
        </div>
      </div>
    </div>

  </article>
</section>


<!-- Loader -->
<ng-template #loadingTpl>
  <div class="loading-spinner">Loading posts...</div>
</ng-template>







  </div>

  <!-- Load More -->
  <div *ngIf="hasMore && !loading" class="load-more">
    <button (click)="loadMorePosts()" class="load-more-btn">
      Load More Posts
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && posts.length === 0" class="empty-feed">
    <div class="empty-content">
      <i class="fas fa-camera"></i>
      <h3>Welcome to DFashion</h3>
      <p>Follow fashion influencers to see their latest posts and discover trending styles!</p>
    </div>
  </div>
</div>
