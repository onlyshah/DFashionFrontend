<nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
  <!-- Brand -->
  <div class="navbar-brand-wrapper d-flex justify-content-center">
    <div class="navbar-brand-inner-wrapper d-flex justify-content-between align-items-center w-100">
      <a class="navbar-brand brand-logo" routerLink="/admin">
        <img src="assets/images/logo.svg" alt="DFashion" />
      </a>
      <a class="navbar-brand brand-logo-mini" routerLink="/admin">
        <img src="assets/images/logo-mini.svg" alt="DFashion" />
      </a>
      <button mat-icon-button class="navbar-toggler" (click)="toggleSidebar()">
        <mat-icon>menu</mat-icon>
      </button>
    </div>
  </div>

  <!-- Main menu wrapper -->
  <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
    <!-- Left: search & breadcrumbs -->
    <div class="d-flex align-items-center me-auto">
      <form class="search-form d-none d-md-block me-3" (submit)="$event.preventDefault(); onSearch();">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search</mat-label>
          <input matInput [(ngModel)]="searchQuery" name="search" (input)="onSearch()" />
          <button mat-icon-button matSuffix type="button" (click)="onSearch()">
            <mat-icon *ngIf="!isSearching">search</mat-icon>
            <mat-progress-spinner *ngIf="isSearching" diameter="18" mode="indeterminate"></mat-progress-spinner>
          </button>
        </mat-form-field>
      </form>

      <nav class="breadcrumb-wrapper d-none d-md-flex align-items-center" aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item">
            <a routerLink="/admin"><mat-icon>dashboard</mat-icon></a>
          </li>
          <li class="breadcrumb-item" *ngFor="let crumb of breadcrumbs; let last = last" [class.active]="last">
            <ng-container *ngIf="!last && crumb.link">
              <a [routerLink]="crumb.link"><mat-icon class="breadcrumb-icon">{{crumb.icon}}</mat-icon> {{crumb.label}}</a>
            </ng-container>
            <ng-container *ngIf="last">
              <span><mat-icon class="breadcrumb-icon">{{crumb.icon}}</mat-icon> {{crumb.label}}</span>
            </ng-container>
          </li>
        </ol>
      </nav>
    </div>

    <!-- Right: quick actions, notifications, profile -->
    <div class="d-flex align-items-center">
      <button mat-icon-button [matMenuTriggerFor]="quickActionsMenu" matTooltip="Quick Actions" class="me-2">
        <mat-icon>add_circle</mat-icon>
      </button>
      <mat-menu #quickActionsMenu="matMenu">
        <button mat-menu-item *ngFor="let action of quickActions" [routerLink]="action.link">
          <mat-icon>{{action.icon}}</mat-icon>
          <span>{{action.label}}</span>
        </button>
      </mat-menu>

      <button mat-icon-button [matMenuTriggerFor]="notificationMenu" class="me-2">
        <mat-icon [matBadge]="notificationCount" [matBadgeHidden]="notificationCount === 0" matBadgeColor="warn">notifications</mat-icon>
      </button>
      <mat-menu #notificationMenu="matMenu">
        <div class="px-3 py-2">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Notifications</h6>
            <button mat-button *ngIf="notificationCount > 0" (click)="markAllAsRead()">Mark all</button>
          </div>
        </div>
        <mat-divider></mat-divider>
        <div class="notification-list" style="max-height:300px; overflow:auto;">
          <button mat-menu-item *ngFor="let n of recentNotifications" (click)="onNotificationClick(n)" [class.unread]="!n.read">
            <mat-icon>{{ n.icon || 'notifications' }}</mat-icon>
            <div class="ms-2">
              <div class="notification-title">{{ n.title }}</div>
              <div class="notification-time small text-muted">{{ formatNotificationTime(n.time) }}</div>
            </div>
          </button>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/admin/notifications">View all</button>
      </mat-menu>

      <button mat-icon-button [matMenuTriggerFor]="profileMenu">
        <img [src]="currentUser?.avatar ? (imageUrl + currentUser?.avatar) : 'assets/images/default-avatar.png'" alt="profile" class="profile-pic" />
      </button>
      <mat-menu #profileMenu="matMenu">
        <button mat-menu-item routerLink="/admin/profile">
          <mat-icon>person</mat-icon>
          <span>My Profile</span>
        </button>
        <button mat-menu-item routerLink="/admin/settings">
          <mat-icon>settings</mat-icon>
          <span>Settings</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>
  </div>
</nav>

<!-- Small page title shown under navbar on mobile or when needed -->
<div class="navbar-page-title d-md-none p-2">
  <h1 class="h6 mb-0">{{ pageTitle || 'Dashboard' }}</h1>
</div>
